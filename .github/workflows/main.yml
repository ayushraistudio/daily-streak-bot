name: Ultimate Streak Bot (7-Day Cycle)

on:
  schedule:
    # Schedule wahi hai: 12 PM, 8 PM, 10 PM, 12 AM (IST timings)
    - cron: '30 6,14,16,18 * * *'
  
  workflow_dispatch:
    inputs:
      force_mode:
        description: 'Manual Mode Select Karo'
        required: true
        default: 'auto'
        type: choice
        options:
        - auto
        - blast_today
        - cleanup

permissions:
  contents: write

jobs:
  daily-cycle:
    runs-on: ubuntu-latest
    
    steps:
      - name: üì• Checkout Repository
        uses: actions/checkout@v3

      - name: ‚öôÔ∏è Configure Git
        env:
          USER_EMAIL: ${{ secrets.USER_EMAIL }}
          USER_NAME: ${{ github.repository_owner }}
        run: |
          git config --global user.name "$USER_NAME"
          git config --global user.email "$USER_EMAIL"

      - name: üöÄ Run 7-Day Logic
        env:
          MANUAL_MODE: ${{ inputs.force_mode }}
        run: |
          # --- Time & Day Calculation ---
          current_hour=$(date -u +%H)
          day_of_week=$(date +%u) # 1=Monday, 7=Sunday
          
          # Default Commit Count set kar rahe hain din ke hisaab se
          case $day_of_week in
            1) count=1 ;; # Monday
            2) count=2 ;; # Tuesday
            3) count=3 ;; # Wednesday
            4) count=4 ;; # Thursday
            5) count=3 ;; # Friday
            6) count=5 ;; # Saturday
            7) count=2 ;; # Sunday
            *) count=1 ;; # Backup (just in case)
          esac

          echo "üìÖ Aaj Day-$day_of_week hai. Target Commits: $count"
          echo "‚è∞ Current UTC Hour: $current_hour"

          # --- LOGIC START ---

          # CONDITION 1: 8 PM Blast (IST) ya Manual 'blast_today'
          if [ "$current_hour" -eq "14" ] || [ "$MANUAL_MODE" == "blast_today" ]; then
            
            echo "üî• 8 PM Blast Mode ON. Aaj $count commits honge..."
            for ((i=1; i<=count; i++))
            do
              echo "Log Entry $i | Day $day_of_week | $(date)" >> activity_log.txt
              git add activity_log.txt
              git commit -m "feat(daily-log): update entry $i for day $day_of_week üöÄ"
            done
            
          # CONDITION 2: 10 PM Cleanup (IST) ya Manual 'cleanup'
          elif [ "$current_hour" -eq "16" ] || [ "$MANUAL_MODE" == "cleanup" ]; then
            
            echo "üßπ 10 PM Cleanup Mode ON. File reset ho rahi hai..."
            # Yeh command file ko overwrite karke blank/fresh bana deti hai
            echo "‚úÖ Daily Log Reset: $(date)" > activity_log.txt
            git add activity_log.txt
            git commit -m "chore(maint): cleaning up daily logs for fresh start üßπ"

          # CONDITION 3: Normal Routine (12 PM & 12 AM)
          # Yeh 'else' block ensure karta hai ki agar upar wale time nahi hain,
          # toh ye chalega hi chalega. Miss hone ka chance nahi.
          else
            
            echo "üü¢ Routine Check Mode (Fixed)"
            echo "Routine verification: $(date)" >> activity_log.txt
            git add activity_log.txt
            git commit -m "chore(bot): routine health check ‚úÖ"
          fi
          
      - name: üì§ Push Changes
        run: git push
        
